{% extends "base.html" %}

{% block title %}Статистика{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/stats.css') }}">
{% endblock %}

{% block content %}
<h1><img src="{{ url_for('static', path='assets/bx-bar-chart-alt-2.svg') }}" class="invert"> Статистика и оценки</h1>

<div class="stats-container">
  <div class="filter-section">
    <div class="filter-group">
      <label for="subjectFilter">Предмет:</label>
      <select id="subjectFilter" onchange="applyFilters()">
        <option value="">Все предметы</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="dateFrom">С:</label>
      <input type="date" id="dateFrom" onchange="applyFilters()">
    </div>

    <div class="filter-group">
      <label for="dateTo">По:</label>
      <input type="date" id="dateTo" onchange="applyFilters()">
    </div>

    <button class="btn-add-grade" onclick="showAddGradeModal()">
      + Добавить оценку
    </button>
  </div>

  <h2>Средний балл</h2>
  <div class="subjects-grid" id="averagesContainer"></div>

  <h2>Все оценки</h2>
  <div class="all-grades-table">
    <table id="gradesTable">
      <thead>
      <tr>
        <th>Дата</th>
        <th>Предмет</th>
        <th>Оценка</th>
        <th>Вес</th>
        <th>Описание</th>
        <th>Урок</th>
        <th>Действия</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div id="gradeModal" class="modal">
  <div class="modal-content">
    <h2 id="gradeModalTitle">Добавить оценку</h2>
    <form id="gradeForm">
      <input type="hidden" id="gradeId" name="gradeId">
      <input type="hidden" id="gradeLessonId" name="lesson_id">

      <div class="form-group">
        <label for="gradeSubject">Предмет *</label>
        <select id="gradeSubject" name="subject_id" required>
          <option value="">Выберите предмет</option>
          {% for subject in subjects %}
          <option value="{{ subject.id }}">{{ subject.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="gradeValue">Оценка *</label>
        <select id="gradeValue" name="value" required>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <div class="form-group">
        <label for="gradeWeight">Вес оценки</label>
        <select id="gradeWeight" name="weight">
          <option value="1.0">Обычная (1.0)</option>
          <option value="1.5">Контрольная (1.5)</option>
          <option value="2.0">Экзамен (2.0)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="gradeDate">Дата *</label>
        <input type="date" id="gradeDate" name="date" required>
      </div>

      <div class="form-group">
        <label for="gradeDescription">Описание</label>
        <input type="text" id="gradeDescription" name="description" placeholder="Контрольная работа, Ответ у доски...">
      </div>

      <div class="modal-buttons">
        <button type="submit" class="btn btn-primary">Сохранить</button>
        <button type="button" class="btn btn-secondary" onclick="closeGradeModal()">Отмена</button>
        <button type="button" class="btn btn-danger" id="deleteGradeBtn" style="display: none;" onclick="deleteGrade()">Удалить</button>
      </div>
    </form>
  </div>
</div>

<script src="{{ url_for('static', filename='js/stats.js') }}"></script>
{% endblock %}