{% extends "base.html" %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/stats.css') }}">
{% endblock %}

{% block content %}
<h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –æ—Ü–µ–Ω–∫–∏</h1>

<div class="stats-container">
  <div class="filter-section">
    <div class="filter-group">
      <label for="subjectFilter">–ü—Ä–µ–¥–º–µ—Ç:</label>
      <select id="subjectFilter" onchange="applyFilters()">
        <option value="">–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="dateFrom">–°:</label>
      <input type="date" id="dateFrom" onchange="applyFilters()">
    </div>

    <div class="filter-group">
      <label for="dateTo">–ü–æ:</label>
      <input type="date" id="dateTo" onchange="applyFilters()">
    </div>

    <button class="btn-add-grade" onclick="showAddGradeModal()">
      + –î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É
    </button>
  </div>

  <h2>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h2>
  <div class="subjects-grid" id="averagesContainer"></div>

  <h2>–í—Å–µ –æ—Ü–µ–Ω–∫–∏</h2>
  <div class="all-grades-table">
    <table id="gradesTable">
      <thead>
      <tr>
        <th>–î–∞—Ç–∞</th>
        <th>–ü—Ä–µ–¥–º–µ—Ç</th>
        <th>–û—Ü–µ–Ω–∫–∞</th>
        <th>–í–µ—Å</th>
        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
        <th>–£—Ä–æ–∫</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<div id="gradeModal" class="modal">
  <div class="modal-content">
    <h2 id="gradeModalTitle">–î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</h2>
    <form id="gradeForm">
      <input type="hidden" id="gradeId" name="gradeId">
      <input type="hidden" id="gradeLessonId" name="lesson_id">

      <div class="form-group">
        <label for="gradeSubject">–ü—Ä–µ–¥–º–µ—Ç *</label>
        <select id="gradeSubject" name="subject_id" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
          {% for subject in subjects %}
          <option value="{{ subject.id }}">{{ subject.name }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="gradeValue">–û—Ü–µ–Ω–∫–∞ *</label>
        <select id="gradeValue" name="value" required>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5</option>
        </select>
      </div>

      <div class="form-group">
        <label for="gradeWeight">–í–µ—Å –æ—Ü–µ–Ω–∫–∏</label>
        <select id="gradeWeight" name="weight">
          <option value="1.0">–û–±—ã—á–Ω–∞—è (1.0)</option>
          <option value="1.5">–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è (1.5)</option>
          <option value="2.0">–≠–∫–∑–∞–º–µ–Ω (2.0)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="gradeDate">–î–∞—Ç–∞ *</label>
        <input type="date" id="gradeDate" name="date" required>
      </div>

      <div class="form-group">
        <label for="gradeDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
        <input type="text" id="gradeDescription" name="description" placeholder="–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞, –û—Ç–≤–µ—Ç —É –¥–æ—Å–∫–∏...">
      </div>

      <div class="modal-buttons">
        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button type="button" class="btn btn-secondary" onclick="closeGradeModal()">–û—Ç–º–µ–Ω–∞</button>
        <button type="button" class="btn btn-danger" id="deleteGradeBtn" style="display: none;" onclick="deleteGrade()">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
    </form>
  </div>
</div>

<script src="{{ url_for('static', path='js/stats.js') }}"></script>
{% endblock %}