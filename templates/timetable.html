{% extends "base.html" %}

{% block title %}–®–∞–±–ª–æ–Ω —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/templates.css') }}">
<style>
    .teacher-only {
        display: {% if user and user.is_teacher %}block{% else %}none{% endif %};
    }
    .student-only {
        display: {% if user and not user.is_teacher %}block{% else %}none{% endif %};
    }
</style>
{% endblock %}

{% block content %}
<h1>üìÖ –®–∞–±–ª–æ–Ω —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</h1>

<div class="templates-container">
    <button class="generate-btn" onclick="generateLessons()">
        üîÑ –°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫–∏ –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏ –≤–ø–µ—Ä–µ–¥ –∏–∑ —à–∞–±–ª–æ–Ω–∞
    </button>

    {% for day_index in range(7) %}
    <div class="day-section" data-day="{{ day_index }}">
        <div class="day-title">{{ weekdays[day_index] }}</div>

        <div class="templates-list" id="templates-{{ day_index }}">
            {% for template in templates if template.day_of_week == day_index %}
            <div class="template-lesson" data-template-id="{{ template.id }}">
                <div class="lesson-number">{{ template.lesson_number }}.</div>
                <div class="lesson-subject">{{ template.subject.name }}</div>
                <div class="lesson-time">
                    {% if template.start_time %}
                    {{ template.start_time }}{% if template.end_time %} - {{ template.end_time }}{% endif %}
                    {% else %}
                    –í—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ
                    {% endif %}
                </div>
                <!-- –î–µ–π—Å—Ç–≤–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π -->
                <div class="lesson-actions teacher-only">
                    <button onclick="editTemplate({{ template.id }})" class="edit-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                    <button onclick="deleteTemplate({{ template.id }})" class="delete-btn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Ä–æ–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π -->
        <button class="add-lesson-btn teacher-only" onclick="showAddTemplateModal({{ day_index }})">
            + –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫ –≤ {{ weekdays[day_index]|lower }}
        </button>
    </div>
    {% endfor %}
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Ä–æ–∫–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π -->
<div id="templateModal" class="modal teacher-only" style="display: none;">
    <div class="modal-content">
        <h2 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫ –≤ —à–∞–±–ª–æ–Ω</h2>
        <form id="templateForm">
            <input type="hidden" id="templateId" name="templateId">
            <input type="hidden" id="templateDay" name="day_of_week">

            <!-- –ü–æ–ª–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å –∫–Ω–æ–ø–∫–æ–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
            <div class="form-group subject-group">
                <label for="templateSubject">–ü—Ä–µ–¥–º–µ—Ç *</label>
                <div class="subject-select-wrapper">
                    <select id="templateSubject" name="subject_id" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
                        {% for subject in subjects %}
                        <option value="{{ subject.id }}">{{ subject.name }}</option>
                        {% endfor %}
                    </select>
                    <button type="button" class="add-subject-btn" onclick="showNewSubjectModal()" title="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç">
                        <span class="plus-icon">+</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label for="templateLessonNumber">–ù–æ–º–µ—Ä —É—Ä–æ–∫–∞ *</label>
                <input type="number" id="templateLessonNumber" name="lesson_number" min="1" max="8" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="templateStartTime">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
                    <input type="time" id="templateStartTime" name="start_time">
                </div>

                <div class="form-group">
                    <label for="templateEndTime">–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                    <input type="time" id="templateEndTime" name="end_time">
                </div>
            </div>

            <div class="form-group">
                <label for="templateRoom">–ö–∞–±–∏–Ω–µ—Ç</label>
                <input type="text" id="templateRoom" name="room" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 301">
            </div>

            <div class="modal-buttons">
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ - —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π -->
<div id="newSubjectModal" class="modal teacher-only" style="display: none;">
    <div class="modal-content small-modal">
        <h2>‚ûï –ù–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç</h2>
        <form id="newSubjectForm" onsubmit="createNewSubject(event)">
            <div class="form-group">
                <label for="newSubjectName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ *</label>
                <input type="text" id="newSubjectName" name="name" required
                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–ª–≥–µ–±—Ä–∞, –§–∏–∑–∏–∫–∞, –ò—Å—Ç–æ—Ä–∏—è"
                       maxlength="50">
            </div>

            <div class="form-group">
                <label for="newSubjectDescription">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <textarea id="newSubjectDescription" name="description"
                          rows="3" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞"></textarea>
            </div>

            <div class="modal-buttons">
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
                <button type="button" class="btn btn-secondary" onclick="closeNewSubjectModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è - —Ç–æ–ª—å–∫–æ –¥–ª—è —É—á–∏—Ç–µ–ª–µ–π -->
<div id="confirmModal" class="modal teacher-only" style="display: none;">
    <div class="modal-content small-modal">
        <h2>‚ö†Ô∏è –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h2>
        <p id="confirmMessage">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —É—Ä–æ–∫?</p>
        <div class="modal-buttons">
            <button class="btn btn-danger" onclick="confirmDelete()">–£–¥–∞–ª–∏—Ç—å</button>
            <button class="btn btn-secondary" onclick="closeConfirmModal()">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<script src="{{ url_for('static', path='js/add_lesson.js') }}"></script>
<script>
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
    document.addEventListener('DOMContentLoaded', function() {
        const isTeacher = {{ 'true' if user and user.is_teacher else 'false' }};

        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤
        if (!isTeacher) {
            window.showAddTemplateModal = function() {
                alert('–¢–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ');
            };
            window.editTemplate = function() {
                alert('–¢–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ');
            };
            window.deleteTemplate = function() {
                alert('–¢–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è –º–æ–≥—É—Ç —É–¥–∞–ª—è—Ç—å —É—Ä–æ–∫–∏');
            };
            window.showNewSubjectModal = function() {
                alert('–¢–æ–ª—å–∫–æ —É—á–∏—Ç–µ–ª—è –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç—ã');
            };
        }
    });
</script>
{% endblock %}